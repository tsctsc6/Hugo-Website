+++
date = '2025-05-20T16:51:33+08:00'
draft = false
title = '计算机图形学-阴影'
categories = ['Sub Sections']
math = false
+++

阴影分为硬阴影和软阴影两种。

## 硬阴影
着色点的阴影相关的属性，只有在或不在阴影中，这种阴影被称为硬阴影。这种阴影的边缘是锐利的。

## 软阴影
这种阴影的边缘是不锐利的。阴影的边缘，越靠近物体，就越锐利。看起来真实。

在实际生活中，不存在点光源。光源是有大小的。所以如果眼前有物体遮挡光源，光源完全不可见的部分，称为本影(Umbra)，光源部分可见的部分，称为半影(Penumbra)。

# Shadow Mapping
在讲光线追踪之前，先了解一下在不使用光线追踪方法前提下，如何渲染阴影。

## Key idea
1. 只能处理点光源。
2. 如果光源能看到着色点，并且摄像机能看到着色点，那么该着色点不在阴影里。

## 具体步骤
1. 把摄像机放到点光源的位置，做一次光栅化，得到一张图像。记录下深度信息，也就是能被点光源看到的点到光源的距离。这就是阴影图。
2. 正常地进行光栅化。在光栅化的过程中，检查到了某个点，尝试把该点重新投影回步骤1的位置的摄像机(在光源位置做光栅化的前半部分)，得到该点到点光源的距离。这个距离与步骤1中的距离图像做比较，如果距离相等，说明这个点也能被点光源看到，这个点不在阴影中。

## Shadow Mapping 的问题
1. 只能做硬阴影。(也有改进版，可以做软阴影了)
1. 比较距离相等，使比较困难的。因为距离是浮点数。如果戳用各种比较浮点数相等的办法，可以稍微缓解，但不能解决根本问题。
2. 阴影图的分辨率是个问题。如果太大，性能开销太大；如果太小，会有走样的问题。

# Why Ray Tracing
我们有时需要处理全局性的问题。

1. 软阴影
2. Glossy reflection(类似铜镜的反射，不是完全镜面的反射)
3. Indirect illumination(间接光照，简单来说就是光线经过多次反射的光照效果)

虽然以上这些，使用特殊的光栅化方法还是可以做到的，但是比较麻烦，而且不能保证物理上的正确性。

|  | 光栅化 | 光线追踪 |
| :--: | :--: | :--: |
| 速度 | 快，实时的场景(游戏) | 慢，离线的场景(电影) |
| 质量 | 差 | 好，十分真实的渲染结果 |

# What is light rays
光学根据研究的尺度可以分为波动光学(Wave Optics)和几何光学(Geometric Optics)，波动光学比几何光学复杂，而由于计算机图形学领域关注的尺度远大于可见光的波长(380 nm 到 780 nm)，也很少涉及光的偏振、干涉和衍射等波动光学才能解释的现象，所以我们一般用几何光学来建立光照模型。

在计算机图形学的领域中，光线有以下的性质:

1. 光沿直线传播
1. 光线不会碰撞
1. 光路可逆

# Ray Casting(Local only)
这里，认为摄像机是一个点。

1. 对于成像平面的某个像素，从摄像机处发出一条光线，穿过像素点。这条光线被称为 eye ray 或 camera ray 。
2. eye ray 会和某物体相交。与第一个物体相交的点，称为 intersection point 。
3. intersection point 与光源连一条线，称为 shadow ray 。如果 shadow ray 没有和任何物体相交，说明这一点不是阴影。
4. 接下来就是算出 intersection point 的法线，做正常的着色流程。
